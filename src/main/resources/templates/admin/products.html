<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Manage Products</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
	href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
	rel="stylesheet" />
<script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('hidden');
        }
    </script>
<script>
    if (performance.navigation.type === 2) {
        // user clicked back button
        window.location.href = "/admin/products";
    }
</script>
</head>

<body class="bg-gray-100">

                                                                                 
	<!-- Top Navbar (mobile only) -->
	
<div class="bg-blue-900 text-white p-4 flex items-center justify-between md:hidden">
    <a href="/admin/dashboard" class="text-xl font-bold">
        Admin Panel
    </a>
    <button onclick="toggleSidebar()" class="text-white focus:outline-none text-2xl">
        ☰
    </button>
</div>

	<div class="flex flex-col md:flex-row min-h-screen">

		<!-- Sidebar -->
		<aside id="sidebar"
			class="bg-blue-900 text-white w-full md:w-64 md:block hidden">
			<div
				class="p-6 text-center text-xl font-bold border-b border-blue-700">Admin
				Panel</div>
			<nav class="flex flex-col p-4 space-y-2">
				<a href="/admin/dashboard" class="hover:bg-blue-700 p-2 rounded">Dashboard</a>
				<a href="/admin/users" class="hover:bg-blue-700 p-2 rounded">Manage
					Users</a> <a href="/admin/products" class="bg-blue-700 p-2 rounded">Manage
					Products</a> <a href="/admin/orders"
					class="hover:bg-blue-700 p-2 rounded">Manage Orders</a> <a
					href="/admin/payments" class="hover:bg-blue-700 p-2 rounded">Manage
					Payments</a> <a href="/admin/settings"
					class="hover:bg-blue-700 p-2 rounded">Settings</a>
			</nav>
			<div class="p-4 border-t border-blue-700">
				<a href="/admin/logout" class="block text-red-400 hover:text-white">Logout</a>
			</div>
		</aside>

		<!-- Main Content -->
	<main class="flex-1 p-4 md:p-7">
	<!-- Success Message -->
<div id="successAlert" th:if="${success}" class="bg-green-100 text-green-800 px-4 py-2 rounded mb-4 transition-opacity duration-500">
    <span th:text="${success}"></span>
</div>

    <div class="max-w-7xl mx-auto">

      <div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between">
    <!-- Heading + Subheading -->
    <div>
        <h1 class="text-2xl md:text-3xl font-semibold text-gray-800">Manage Products</h1>
        <p class="text-gray-500 text-sm md:text-base">List of all available products</p>
    </div>

    <!-- Add Product Button -->
    <a href="/admin/add"
       class="mt-4 md:mt-0 bg-blue-600 hover:bg-blue-700 text-white text-sm px-5 py-2 rounded shadow-md transition duration-200">
        + Add Product
    </a>
</div>

      
				<!-- Search Bar -->
				<!-- Search Bar (Client-Side Filtering) -->
				<div
					class="flex flex-col md:flex-row items-center justify-between mb-4 space-y-2 md:space-y-0">
					<input id="searchInput" onkeyup="searchProducts()" type="text"
						placeholder="Search by name or description"
						class="w-full md:w-1/3 px-4 py-2 border border-gray-300 rounded shadow-sm focus:outline-none" />
				</div>




				<!-- Product Card Grid -->
				<!-- Product Card Grid -->
				<div
					class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
					<div class="bg-white shadow rounded p-3 text-sm product-card"
						th:each="product : ${products}"
						
						th:attr="data-name=${product.name}, data-description=${product.description}">

						<!-- Product Image -->
						<div
							class="w-full h-24 bg-gray-100 flex items-center justify-center rounded overflow-hidden">
							<img th:src="@{/admin/products/image/{id}(id=${product.id})}" class="w-24 h-24 object-cover"/>
 <img
								th:if="${imageMap[product.id]} == null"
								src="https://i.imgur.com/Q2BAOd2.png"
								alt="Default Product Image" class="object-cover h-full w-full" />

						</div>

						<!-- Product Details -->
						<div class="mt-3">
							<h2 class="font-semibold text-gray-800 truncate"
								th:text="${product.name}">Product Name</h2>
							<p class="text-gray-600 mt-1 truncate"
								th:text="${product.description}">Product description</p>
							<p class="text-blue-600 font-semibold mt-2"
								th:text="'₹' + ${product.price}">₹0.00</p>
							<!-- Action Icons -->
							<!-- Action Icons -->
							<div class="flex justify-end space-x-3 mt-2">
								<!-- Edit Icon -->
								<a th:href="@{'/admin/products/edit/' + ${product.id}}"
									title="Edit"> <svg xmlns="http://www.w3.org/2000/svg"
										class="h-5 w-5 text-blue-500 hover:text-blue-700"
										viewBox="0 0 20 20" fill="currentColor">
                                <path
											d="M17.414 2.586a2 2 0 010 2.828l-10 10A2 2 0 016.586 16H4a1 1 0 01-1-1v-2.586a2 2 0 01.586-1.414l10-10a2 2 0 012.828 0z" />
                            </svg>
								</a>

								<!-- Delete Icon -->
								<a href="javascript:void(0);"
   th:attr="data-product-id=${product.id}"
   onclick="openDeleteModal(this)" 
   title="Delete"> <svg
										xmlns="http://www.w3.org/2000/svg"
										class="h-5 w-5 text-red-500 hover:text-red-700"
										viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
											d="M6 2a1 1 0 00-1 1v1H3a1 1 0 100 2h.293l.853 10.243A2 2 0 006.138 18h7.724a2 2 0 001.992-1.757L16.707 6H17a1 1 0 100-2h-2V3a1 1 0 00-1-1H6zM8 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z"
											clip-rule="evenodd" />
                            </svg>
								</a>
							</div>

						</div>
					</div>
				</div>
			</div>
			<!-- Delete Confirmation Modal -->
			<div id="deleteModal"
				class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
				<div class="bg-white p-6 rounded-lg shadow-md w-full max-w-md">
					<h2 class="text-lg font-semibold text-gray-800 mb-4">Confirm
						Deletion</h2>
					<p class="text-gray-600 mb-6">Are you sure you want to delete
						this product?</p>
					<div class="flex justify-end space-x-3">
						<button onclick="closeDeleteModal()"
							class="px-4 py-2 text-gray-600 hover:text-white hover:bg-gray-500 rounded">
							Cancel</button>
						<a id="confirmDeleteBtn"
							class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
							Delete </a>
					</div>
				</div>
			</div>


			<!-- Pagination Controls -->
			<div class="mt-10 flex justify-center items-center space-x-1 text-sm">

				<!-- Previous -->
				<a th:if="${currentPage > 0}"
					th:href="@{/admin/products(page=${currentPage - 1}, keyword=${keyword})}"
					class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-blue-600 hover:text-white transition">
					← Prev </a>

				<!-- Page Numbers -->
				<span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
					<a th:href="@{/admin/products(page=${i}, keyword=${keyword})}"
					th:text="${i + 1}"
					class="px-4 py-2 border rounded-md transition duration-200"
					th:classappend="${i == currentPage} ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-700 border-gray-300 hover:bg-blue-50 hover:text-blue-600'">
				</a>
				</span>

				<!-- Next -->
				<a th:if="${currentPage < totalPages - 1}"
					th:href="@{/admin/products(page=${currentPage + 1}, keyword=${keyword})}"
					class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-blue-600 hover:text-white transition">
					Next → </a>

			</div>


		</main>

	</div>

</body>

<script>
   /*  function openDeleteModal(element) {
        const productId = element.getAttribute("data-product-id");
        const modal = document.getElementById('deleteModal');
        const confirmBtn = document.getElementById('confirmDeleteBtn');
        confirmBtn.href = `/admin/products/delete/${productId}`;
        modal.classList.remove('hidden');
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.add('hidden');
    } */
    function openDeleteModal(button) {
        const productId = button.getAttribute("data-product-id");
        const confirmBtn = document.getElementById("confirmDeleteBtn");
        confirmBtn.setAttribute("href", "/admin/products/delete/" + productId);
        document.getElementById("deleteModal").classList.remove("hidden");
    }

    function closeDeleteModal() {
        document.getElementById("deleteModal").classList.add("hidden");
    }


</script>
<script>
function searchProducts() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const cards = document.getElementsByClassName("product-card");

    Array.from(cards).forEach(card => {
        const name = card.getAttribute("data-name").toLowerCase();
        const description = card.getAttribute("data-description").toLowerCase();

        if (name.includes(input) || description.includes(input)) {
            card.style.display = "block";
        } else {
            card.style.display = "none";
        }
    });
}

</script>
<script>
  // Auto-hide success alert after 2 seconds
  setTimeout(function () {
    const alert = document.getElementById("successAlert");
    if (alert) {
      alert.classList.add("opacity-10");
      setTimeout(() => alert.remove(), 500); // Remove from DOM after fade-out
    }
  }, 1000);
</script>

</html>
