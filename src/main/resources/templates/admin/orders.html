<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Manage Orders</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <script defer>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('hidden');
        }
    </script>
</head>
<body class="bg-gray-100">

<!-- Top Navbar (mobile only) -->
<div class="bg-blue-900 text-white p-4 flex items-center justify-between md:hidden">
    <div class="text-xl font-bold">Admin Panel</div>
    <button onclick="toggleSidebar()" class="text-white focus:outline-none">☰</button>
</div>

<!-- Page Layout -->
<div class="flex flex-col md:flex-row min-h-screen">

    <!-- Sidebar -->
    <aside id="sidebar" class="bg-blue-900 text-white w-full md:w-64 md:block hidden">
        <div class="p-6 text-center text-xl font-bold border-b border-blue-700">Admin Panel</div>
        <nav class="flex flex-col p-4 space-y-2">
            <a href="/admin/dashboard" class="hover:bg-blue-700 p-2 rounded">Dashboard</a>
            <a href="/admin/users" class="hover:bg-blue-700 p-2 rounded">Manage Users</a>
            <a href="/admin/products" class="hover:bg-blue-700 p-2 rounded">Manage Products</a>
            <a href="/admin/orders" class="bg-blue-700 p-2 rounded">Manage Orders</a>
            <a href="/admin/payments" class="hover:bg-blue-700 p-2 rounded">Manage Payments</a>
            <a href="/admin/settings" class="hover:bg-blue-700 p-2 rounded">Settings</a>
        </nav>
        <div class="p-4 border-t border-blue-700">
            <a href="/admin/logout" class="block text-red-400 hover:text-white">Logout</a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-4 md:p-7">
        <div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between">
    <!-- Left: Header -->
    <div class="mb-4 md:mb-0">
        <h1 class="text-3xl font-semibold text-gray-800">Manage Orders</h1>
        <p class="text-gray-500">View and manage all orders placed by users</p>
    </div>

    <!-- Right: Total Stats -->
    <div class="bg-white p-2 rounded shadow">
        <p class="text-gray-700"><strong>Total Orders:</strong> <span th:text="${totalOrders}">0</span></p>
        <p class="text-gray-700"><strong>Total Revenue:</strong> ₹<span th:text="${totalRevenue}">0.00</span></p>
    </div>
</div>

<!-- Filter Section -->
<!-- Search and Filters Form -->
<div class="mb-5 bg-white p-4 rounded shadow">
    <form action="/admin/orders" method="get" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6 items-end">
        
        <!-- Order ID / User Name -->
        <div class="flex flex-col">
            <label class="text-sm font-medium text-gray-700">Order ID / User Name</label>
            <input type="text" name="keyword" th:value="${keyword}" placeholder="e.g. ORD101 or John"
                   class="mt-1 p-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
        </div>

        <!-- Status Filter -->
        <div class="flex flex-col">
            <label for="status" class="text-sm font-medium text-gray-700">Status</label>
            <select name="status" id="status"
                    class="mt-1 p-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"
                    onchange="this.form.submit()">
                <option value="">All Statuses</option>
                <option value="Pending" th:selected="${status == 'Pending'}">Pending</option>
                <option value="Shipped" th:selected="${status == 'Shipped'}">Shipped</option>
                <option value="Delivered" th:selected="${status == 'Delivered'}">Delivered</option>
                <option value="Cancelled" th:selected="${status == 'Cancelled'}">Cancelled</option>
            </select>
        </div>

        <!-- From Date -->
        <div class="flex flex-col">
            <label class="text-sm font-medium text-gray-700">From Date</label>
            <input type="date" name="fromDate" th:value="${fromDate}"
                   class="mt-1 p-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
        </div>

        <!-- To Date -->
        <div class="flex flex-col">
            <label class="text-sm font-medium text-gray-700">To Date</label>
            <input type="date" name="toDate" th:value="${toDate}"
                   class="mt-1 p-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
        </div>

        <!-- Search Button -->
        <div class="flex flex-col">
            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Search</button>
        </div>

        <!-- Reset Button -->
        <div class="flex flex-col">
            <a href="/admin/orders" class="w-full bg-gray-300 text-black text-center py-2 rounded hover:bg-gray-400">Reset Filters</a>
        </div>
    </form>
</div>

<!-- 
<!-- Total Stats 
<div class="mb-4 bg-white p-4 rounded shadow flex justify-between">
    <div>
        <p class="text-gray-700"><strong>Total Orders:</strong> <span th:text="${totalOrders}">0</span></p>
        <p class="text-gray-700"><strong>Total Revenue:</strong> ₹<span th:text="${totalRevenue}">0.00</span></p>
    </div>
</div> -->

        <!-- Orders Table -->
        <div class="overflow-x-auto bg-white rounded shadow">
            <table class="min-w-full divide-y divide-gray-200">
					<thead class="bg-blue-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Order ID</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">User</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    <tr th:each="order : ${orders}">
                        <td class="px-4 py-3" th:text="'ORD' + ${order.id}">ORD1234</td>
                        <td class="px-4 py-3" th:text="${order.user.name}">John Doe</td>
                        <td class="px-4 py-3" th:text="'₹' + ${order.total}">₹1999</td>
                        <td class="px-4 py-3" th:text="${#temporals.format(order.orderDate, 'dd MMM yyyy HH:mm')}">29 Jul 2025</td>
                        <td class="px-4 py-3">
                            <form th:action="@{/admin/order/updateStatus}" method="post">
    <input type="hidden" name="orderId" th:value="${order.id}" />
    
    <select name="status" class="border p-1 rounded" onchange="this.form.submit()">
        <option value="Pending" th:selected="${order.status == 'Pending'}">Pending</option>
        <option value="Shipped" th:selected="${order.status == 'Shipped'}">Shipped</option>
        <option value="Delivered" th:selected="${order.status == 'Delivered'}">Delivered</option>
        <option value="Cancelled" th:selected="${order.status == 'Cancelled'}">Cancelled</option>
    </select>
</form>

                        </td>
                        <td class="px-4 py-3">
                            <a th:href="@{/order/confirmation/{id}(id=${order.id})}" class="text-blue-600 hover:underline">View</a> |
                            <a th:href="@{/admin/orders/delete/{id}(id=${order.id})}" class="text-red-500 hover:underline"
                               onclick="return confirm('Are you sure you want to delete this order?')">Delete</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

       <!-- Pagination -->
<div class="mt-4 flex justify-center space-x-2">
    <a th:if="${currentPage > 0}"
       th:href="@{/admin/orders(
           page=${currentPage - 1},
           status=${status},
           keyword=${keyword},
           fromDate=${fromDate},
           toDate=${toDate}
       )}"
       class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Previous</a>

    <span class="px-3 py-1 text-gray-700 font-medium">
        Page <span th:text="${currentPage + 1}">1</span> of <span th:text="${totalPages}">1</span>
    </span>

    <a th:if="${currentPage + 1 < totalPages}"
       th:href="@{/admin/orders(
           page=${currentPage + 1},
           status=${status},
           keyword=${keyword},
           fromDate=${fromDate},
           toDate=${toDate}
       )}"
       class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Next</a>
</div>

    </main>
</div>

</body>
</html>
